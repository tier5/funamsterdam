!function(a){var b=function(b){var c=this,d=a(b),e={};e.feed=d.find("#gf_ideal_feed"),e.gravityForm=d.find("#gf_ideal_gravity_form"),e.formId=d.find("#_pronamic_pay_gf_form_id"),e.configId=d.find("#gf_ideal_config_id"),e.delayPostCreationItem=d.find("#gf_ideal_delay_post_creation_item"),e.conditionEnabled=d.find("#gf_ideal_condition_enabled"),e.conditionConfig=d.find("#gf_ideal_condition_config"),e.conditionFieldId=d.find("#gf_ideal_condition_field_id"),e.conditionOperator=d.find("#gf_ideal_condition_operator"),e.conditionValue=d.find("#gf_ideal_condition_value"),e.conditionMessage=d.find("#gf_ideal_condition_message"),e.confirmationSelectFields=d.find(".gf_ideal_confirmation_select"),e.userRoleFieldId=d.find("#gf_ideal_user_role_field_id"),e.delayNotifications=d.find("#gf_ideal_delay_notifications"),e.fieldSelectFields=d.find("select.field-select"),e.subscriptionAmountType=d.find('input[name="_pronamic_pay_gf_subscription_amount_type"]'),e.subscriptionAmountField=d.find("#pronamic_pay_gf_subscription_amount_field"),e.subscriptionIntervalType=d.find('input[name="_pronamic_pay_gf_subscription_interval_type"]'),e.subscriptionInterval=d.find("#pronamic_pay_gf_subscription_interval"),e.subscriptionIntervalPeriod=d.find("#pronamic_pay_gf_subscription_interval_period"),e.subscriptionIntervalField=d.find("#pronamic_pay_gf_subscription_interval_field"),e.subscriptionFrequencyType=d.find('input[name="_pronamic_pay_gf_subscription_frequency_type"]'),e.subscriptionFrequency=d.find("#pronamic_pay_gf_subscription_frequency"),e.subscriptionFrequencyField=d.find("#pronamic_pay_gf_subscription_frequency_field");var f=a.parseJSON(e.feed.val()),g=a.parseJSON(e.gravityForm.val());this.updateDelayPostCreationItem=function(){var a=!1;if(g){c.getFieldsByType(["post_title","post_content","post_excerpt","post_category","post_custom_field","post_image","post_tag"]).length>0&&(a=!0)}e.delayPostCreationItem.toggle(a)},this.updateConfirmationFields=function(){e.confirmationSelectFields.empty(),a("<option>").appendTo(e.confirmationSelectFields),g&&a.each(e.confirmationSelectFields,function(b,c){var d=a(c).attr("data-pronamic-link-name"),e=!1;a.each(g.confirmations,function(b,g){e=!1,"object"==typeof f.links&&(e=f.links[d].confirmation_id===g.id),a("<option>").attr("value",g.id).text(g.name).prop("selected",e).appendTo(c)})})},this.toggleConditionConfig=function(){1>=e.conditionFieldId.find("option").length?(e.conditionConfig.fadeOut("fast"),e.conditionEnabled.before(e.conditionConfig),e.conditionMessage.show(),e.conditionEnabled.val(0)):(e.conditionConfig.fadeIn("fast"),e.conditionEnabled.after(e.conditionConfig),e.conditionMessage.hide(),e.conditionEnabled.val(1))},this.updateConditionFields=function(){e.conditionFieldId.empty(),a("<option>").appendTo(e.conditionFieldId),g&&(a.each(g.fields,function(b,c){var d=c.inputType?c.inputType:c.type;if(a.inArray(d,["checkbox","radio","select"])>=0){var g=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(g).prop("selected",1==f.conditionEnabled&&f.conditionFieldId==c.id).appendTo(e.conditionFieldId)}}),e.conditionOperator.val(f.conditionOperator))},this.updateConditionValues=function(){var b=e.conditionFieldId.val(),d=c.getFieldById(b);e.conditionValue.empty(),a("<option>").appendTo(e.conditionValue),d?(e.conditionOperator.removeProp("disabled"),e.conditionValue.removeProp("disabled")):(e.conditionOperator.prop("disabled",!0),e.conditionValue.prop("disabled",!0)),d&&d.choices&&(a.each(d.choices,function(b,c){var d=c.value?c.value:c.text;a("<option>").attr("value",d).text(c.text).appendTo(e.conditionValue)}),e.conditionValue.val(f.conditionValue))},this.getFieldById=function(a){if(g)for(var b=0;b<g.fields.length;b++)if(g.fields[b].id==a)return g.fields[b];return null},this.getFieldsByType=function(b){var c=[];if(g)for(var d=0;d<g.fields.length;d++)a.inArray(g.fields[d].type,b)>=0&&c.push(g.fields[d]);return c},this.getInputs=function(){var b=[];return g&&a.each(g.fields,function(c,d){d.inputs?a.each(d.inputs,function(a,c){b.push(c)}):d.displayOnly||b.push(d)}),b},this.changeForm=function(){jQuery.get(ajaxurl,{action:"gf_get_form_data",formId:e.formId.val()},function(a){a.success&&(g=a.data,c.updateFields())})},this.updateUserRoleFields=function(){e.userRoleFieldId.empty(),a("<option>").appendTo(e.userRoleFieldId),g&&a.each(g.fields,function(b,c){var d=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(d).prop("selected",f.userRoleFieldId==c.id).appendTo(e.userRoleFieldId)})},this.updateConfigFields=function(){var a=e.configId.find("option:selected").attr("data-ideal-method");d.find(".extra-settings").hide(),d.find(".method-"+a).show()},this.updateNotifications=function(){e.delayNotifications.empty(),g&&a.each(g.notifications,function(b,c){if("form_submission"===c.event){var d=a("<li>").appendTo(e.delayNotifications),g="pronamic-pay-gf-notification-"+c.id;a('<input type="checkbox" name="_pronamic_pay_gf_delay_notification_ids[]">').attr("id",g).val(c.id).prop("checked",a.inArray(c.id,f.delayNotificationIds)>=0).appendTo(d),d.append(" "),a("<label>").attr("for",g).text(c.name).appendTo(d)}})},this.updateSubscriptionFields=function(){if(g){e.subscriptionAmountField.empty(),e.subscriptionIntervalField.empty(),e.subscriptionFrequencyField.empty();var h=[];g&&a.each(g.fields,function(a,b){"product"===b.type&&h.push(b)}),d=a(e.subscriptionAmountField),a("<option>").appendTo(d),a.each(h,function(b,c){var e=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(e).prop("selected",f.subscriptionAmountField==c.id).appendTo(d)}),e.subscriptionAmountType.on("change",function(){var c=e.subscriptionAmountType.filter(":checked").val();a(b).find(".pronamic-pay-gf-subscription-amount-settings").hide();var d=a(b).find(".pronamic-pay-gf-subscription-amount-settings.amount-"+c);d.length>0&&d.show()}),e.subscriptionAmountType.trigger("change"),d=a(e.subscriptionIntervalField),a("<option>").appendTo(d),a.each(c.getInputs(),function(b,c){var e=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(e).prop("selected",f.subscriptionIntervalField==c.id).appendTo(d)}),e.subscriptionIntervalType.on("change",function(){var c=e.subscriptionIntervalType.filter(":checked").val();a(b).find(".pronamic-pay-gf-subscription-interval-settings").hide();var d=a(b).find(".pronamic-pay-gf-subscription-interval-settings.interval-"+c);d.length>0&&d.show()}),e.subscriptionIntervalType.trigger("change"),d=a(e.subscriptionFrequencyField),a("<option>").appendTo(d),a.each(c.getInputs(),function(b,c){var e=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(e).prop("selected",f.subscriptionFrequencyField==c.id).appendTo(d)}),e.subscriptionFrequencyType.on("change",function(){var c=e.subscriptionFrequencyType.filter(":checked").val();a(b).find(".pronamic-pay-gf-subscription-frequency-settings").hide();var d=a(b).find(".pronamic-pay-gf-subscription-frequency-settings.frequency-"+c);d.length>0&&d.show()}),e.subscriptionFrequencyType.trigger("change")}},this.updateSelectFields=function(){g&&(e.fieldSelectFields.empty(),e.fieldSelectFields.each(function(b,e){d=a(e);var g=d.data("gateway-field-name");a("<option>").appendTo(d),a.each(c.getInputs(),function(b,c){var e=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(e).prop("selected",f.fields[g]==c.id).appendTo(d)})}))},this.updateFields=function(){c.updateConfigFields(),c.updateDelayPostCreationItem(),c.updateConfirmationFields(),c.updateConditionFields(),c.toggleConditionConfig(),c.updateConditionValues(),c.updateUserRoleFields(),c.updateSubscriptionFields(),c.updateSelectFields(),c.updateNotifications()},c.updateFields(),e.formId.change(c.changeForm),e.configId.change(c.updateConfigFields),e.conditionFieldId.change(c.updateConditionValues)};a.fn.gravityFormsPayFeedEditor=function(){return this.each(function(){var c=a(this);if(!c.data("gf-pay-feed-editor")){var d=new b(this);c.data("gf-pay-feed-editor",d)}})},a(document).ready(function(){a(".gforms_edit_form .ideal-edit-link").click(function(a){a.stopPropagation()}),a("#gf-pay-feed-editor").gravityFormsPayFeedEditor(),"undefined"!=typeof gform&&"undefined"!=typeof form&&gform.addAction("gform_load_field_choices",function(b){var c=b.shift();if(c){var d="pronamic_pay_payment_method_selector"===c.type;a('label[for="field_choice_values_enabled"]').parent("div").toggle(!d),d&&a.each(c.choices,function(b,c){if(c.builtin){var d=a(".field-choice-input.field-choice-value").eq(b);d.attr("disabled","disabled"),d.parent("li").find(".gf_delete_field_choice").remove()}})}}),a(document).on("gform_load_field_settings",function(b,c){a("#pronamic_pay_config_field").val(c.pronamicPayConfigId)})})}(jQuery);
//# sourceMappingURL=admin.min.js.map