!function(t){var e={init:function(){t("body").on("click","img.cfm-clone-field",this.cloneField),t("body").on("click","img.cfm-remove-field",this.removeField),t("body").on("submit","#edd_purchase_form",this.formSubmit),t("form#post").on("submit",this.adminPostSubmit),t("body").on("click","a.upload_file_button",this.fileDownloadable),t("body").on("click","a.insert-file-row",function(e){e.preventDefault();var i=t(this).attr("id"),n=t("#cfm-upload-max-files-"+i).val(),a=t(".cfm-variations-list-"+i),o=a.find(".cfm-single-variation:last"),r=o.clone();delete r[1],r.length=1;var f=a.find(".cfm-single-variation").length;return f+1>n&&0!=n?alert(cfm_form.too_many_files_pt_1+n+cfm_form.too_many_files_pt_2):(r.find("input, select, textarea").val(""),r.find("input, select, textarea").each(function(){var e=t(this).attr("name");e=e.replace(/\[(\d+)\]/,"["+parseInt(f)+"]"),t(this).attr("name",e).attr("id",e),r.insertBefore("#"+i)}),!1)}),t("body").on("click","a.edd-cfm-delete",function(e){e.preventDefault();var i=t(this).parents(".cfm-single-variation"),n=t(this).parents("[class^=cfm-variations-list-]"),a=n.find(".cfm-single-variation").length;return 1==a?(i.find("input, select, textarea").val(""),!1):(i.remove(),!1)})},fileDownloadable:function(e){e.preventDefault();var i,n=t(this);return i?void i.open():(i=wp.media({title:cfm_form.file_title,frame:"select",button:{text:cfm_form.file_button},multiple:!1}),i.on("open",function(){var e=n.closest("tr").find("input.cfm-file-value").attr("data-formid"),i=n.closest("tr").find("input.cfm-file-value").attr("data-fieldname");t.post(cfm_form.ajaxurl,{action:"cfm_turn_on_file_filter",formid:e,name:i},function(t){})}),i.on("close",function(){var e=n.closest("tr").find("input.cfm-file-value").attr("data-formid"),i=n.closest("tr").find("input.cfm-file-value").attr("data-fieldname");t.post(cfm_form.ajaxurl,{action:"cfm_turn_off_file_filter",formid:e,name:i},function(t){})}),i.on("select",function(){var t=i.state().get("selection");t.map(function(t){t=t.toJSON(),n.closest("tr").find("input.cfm-file-value").val(t.url)})}),void i.open())},cloneField:function(e){e.preventDefault();var i=t(this).closest("tr"),n=i.clone(),a=i.parent().find("tr"),o=highest=0;a.each(function(){var e=t(this).data("key");parseInt(e)>highest&&(highest=e)}),o=highest+1,n.attr("data-key",parseInt(o)),n.find(":checked").attr("checked",""),n.find("input, select, textarea").val(""),n.find("input, select, textarea").each(function(){var e=t(this).attr("name");e=e.replace(/\[(\d+)\]/,"["+parseInt(o)+"]"),t(this).attr("name",e).attr("id",e)}),i.after(n)},removeField:function(){var e=t(this).closest("tr"),i=e.siblings().andSelf().length;i>1&&e.remove()},hasItems:function(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1},adminPostSubmit:function(i){var n=t(this);e.validateForm(n)},formSubmit:function(i){var n=t(this);n.find("input[type=submit]");return form_data=e.validateForm(n),form_data?!0:void i.preventDefault()},validateForm:function(e){var i,n=e.serialize(),a=[];return t(".cfm-rich-validation").each(function(e,n){i=t(n).data("id"),val=t.trim(tinyMCE.get(i).getContent()),a.push(i+"="+encodeURIComponent(val))}),n=n+"&"+a.join("&")}};t(function(){e.init()})}(jQuery),webshim.setOptions("forms-ext",{replaceUI:{date:!0,datetime:!0},types:"date datetime",date:{openOnFocus:!0},datetime:{openOnFocus:!0}}),webshim.polyfill("forms forms-ext");