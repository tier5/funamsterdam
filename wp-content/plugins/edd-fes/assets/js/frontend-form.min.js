!function(a){var b,c,d={init:function(){a(".fes-form").on("click","img.fes-clone-field",this.cloneField),a(".fes-form").on("click","img.fes-remove-field",this.removeField),a(".fes-ajax-form").on("submit",this.formSubmit),a(".fes-fields").on("click","a.fes-feat-image-btn",this.featuredImage.addImage),a(".fes-fields").on("click","a.fes-remove-feat-image",this.featuredImage.removeImage),a(".fes-fields").on("click","a.fes-avatar-image-btn",this.avatarImage.addImage),a(".fes-fields").on("click","a.fes-remove-avatar-image",this.avatarImage.removeImage),a(".fes-fields").on("click","a.upload_file_button",this.fileDownloadable),a(".fes-fields").on("click","a.insert-file-row",function(b){b.preventDefault();var c=a(this).attr("id"),d=a("#fes-upload-max-files-"+c).val(),e=a(".fes-variations-list-"+c),f=e.find(".fes-single-variation:last"),g=f.clone();delete g[1],g.length=1;var h=e.find(".fes-single-variation").length;return h+1>d&&0!=d?alert(fes_form.too_many_files_pt_1+d+fes_form.too_many_files_pt_2):(g.find("input, select, textarea").val(""),g.find("input, select, textarea").each(function(){var b=a(this).attr("name");b=b.replace(/\[(\d+)\]/,"["+parseInt(h)+"]"),a(this).attr("name",b).attr("id",b),g.insertBefore("#"+c)}),!1)}),a(".fes-fields").on("click","a.edd-fes-delete",function(b){b.preventDefault();var c=a(this).parents(".fes-single-variation"),d=a(this).parents("[class^=fes-variations-list-]"),e=d.find(".fes-single-variation").length;return 1==e?(c.find("input, select, textarea").val(""),!1):(c.remove(),!1)})},avatarImage:{addImage:function(b){b.preventDefault();var d=a(this);return c?void c.open():(c=wp.media({title:fes_form.avatar_title,button:{text:fes_form.avatar_button},library:{type:"image"}}),c.on("select",function(){var a=c.state().get("selection");a.map(function(a){a=a.toJSON(),d.siblings("input.fes-avatar-image-id").val(a.id);var b=d.closest(".instruction-inside"),c=b.siblings(".image-wrap");c.find("img").attr("src",a.url),b.addClass("fes-hide"),c.removeClass("fes-hide")})}),void c.open())},removeImage:function(b){b.preventDefault();var c=a(this),d=c.closest(".image-wrap"),e=d.siblings(".instruction-inside");e.find("input.fes-avatar-image-id").val("0"),d.addClass("fes-hide"),e.removeClass("fes-hide")}},fileDownloadable:function(b){b.preventDefault();var d,c=a(this);return d?void d.open():(d=wp.media({title:fes_form.file_title,button:{text:fes_form.file_button},multiple:!1}),d.on("open",function(){var b=c.closest("tr").find("input.fes-file-value").attr("data-formid"),d=c.closest("tr").find("input.fes-file-value").attr("data-fieldname");a.post(fes_form.ajaxurl,{action:"fes_turn_on_file_filter",formid:b,name:d},function(a){})}),d.on("close",function(){var b=c.closest("tr").find("input.fes-file-value").attr("data-formid"),d=c.closest("tr").find("input.fes-file-value").attr("data-fieldname");a.post(fes_form.ajaxurl,{action:"fes_turn_off_file_filter",formid:b,name:d},function(a){})}),d.on("select",function(){var a=d.state().get("selection");a.map(function(a){a=a.toJSON(),c.closest("tr").find("input.fes-file-value").val(a.url)})}),void d.open())},featuredImage:{addImage:function(c){c.preventDefault();var d=a(this);return b?void b.open():(b=wp.media({title:fes_form.feat_title,button:{text:fes_form.feat_button},library:{type:"image"}}),b.on("select",function(){var a=b.state().get("selection");a.map(function(a){a=a.toJSON(),d.siblings("input.fes-feat-image-id").val(a.id);var b=d.closest(".instruction-inside"),c=b.siblings(".image-wrap");c.find("img").attr("src",a.url),b.addClass("fes-hide"),c.removeClass("fes-hide")})}),void b.open())},removeImage:function(b){b.preventDefault();var c=a(this),d=c.closest(".image-wrap"),e=d.siblings(".instruction-inside");e.find("input.fes-feat-image-id").val("0"),d.addClass("fes-hide"),e.removeClass("fes-hide")}},cloneField:function(b){b.preventDefault();var c=a(this).closest("tr"),d=c.clone(),e=c.parent().find("tr"),f=highest=0;e.each(function(){var b=a(this).data("key");parseInt(b)>highest&&(highest=b)}),f=highest+1,d.attr("data-key",parseInt(f)),d.find(":checked").attr("checked",""),d.find("input, select, textarea").val(""),d.find("input, select, textarea").each(function(){var b=a(this).attr("name");b=b.replace(/\[(\d+)\]/,"["+parseInt(f)+"]"),a(this).attr("name",b).attr("id",b)}),c.after(d)},removeField:function(){var b=a(this).closest("tr"),c=b.siblings().andSelf().length;c>1&&b.remove()},formSubmit:function(b){b.preventDefault();var c=a(this),e=c.find("input[type=submit]"),f=d.validateForm(c);if(f){var g={lines:13,length:11,width:5,radius:17,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"fes_spinner",zIndex:2e9,top:"auto",left:"auto"};""!==fes_form.loading_icon&&(g.icon=fes_form.loading_icon);var h=document.createElement("div");if(document.body.appendChild(h),""!=fes_form.loading_icon)var i=fesSpinner({text:fes_form.loadingtext,icon:fes_form.loading_icon});else var j=new Spinner(g).spin(h),i=fesSpinner({text:fes_form.loadingtext,spinner:j});e.attr("disabled","disabled").addClass("button-primary-disabled"),a.post(fes_form.ajaxurl,f,function(a){if(a.success){var b="",f="";b=a.title?a.title:fes_form.successtitle,f=a.message?a.message:fes_form.successmessage,a.skipswal?(i.hide(),"#"!==a.redirect_to&&(window.location=a.redirect_to)):(i.hide(),swal({title:b,text:f,html:!0,allowEscapeKey:!1,type:"success"},function(){"#"!==a.redirect_to?window.location.href=a.redirect_to:(e.removeClass("button-primary-disabled"),c.find("span.fes-loading").remove(),e.removeAttr("disabled"))}))}else{var g=a.errors;if("undefined"!=typeof g&&d.hasItems(g)>0)for(var h in g)d.markError(c,h,g[h]);var b="",f="";b=a.title?a.title:fes_form.errortitle,f=a.message?a.message:fes_form.errormessage,i.hide(),swal({title:b,text:f,html:!0,type:"error"}),e.removeAttr("disabled")}e.removeClass("button-primary-disabled"),c.find("span.fes-loading").remove()}).fail(function(b,d,f){var g="",h="";g=fes_form.ajaxerrortitle,h=a(b.responseText).text(),console.log(h),h=h.substring(0,h.indexOf("Call Stack")),i.hide(),swal({title:g,text:h,html:!0,type:"error"}),e.removeAttr("disabled"),e.removeClass("button-primary-disabled"),c.find("span.fes-loading").remove()})}},hasItems:function(a){for(var b in a)if(a.hasOwnProperty(b))return!0;return!1},validateForm:function(b){d.removeErrors(b);var c,e=b.serialize(),f=[];return a(".fes-rich-validation").each(function(b,d){c=a(d).data("id"),val=a.trim(tinyMCE.get(c).getContent()),f.push(c+"="+encodeURIComponent(val))}),e=e+"&"+f.join("&")},markError:function(a,b,c){var d=a.find(".fes-el."+b);d.append('<div class="edd_errors edd-alert edd-alert-error fes-form-field-error" style="margin-bottom: 0px"><p class="edd_error">'+c+"</p></div>")},removeErrors:function(b){a(b).find(".fes-form-field-error").remove()}};a(function(){d.init()})}(jQuery);